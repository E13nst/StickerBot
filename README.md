# StickerBot

## Пользовательский поток

### Старт
- `/start` очищает состояние и предлагает выбор:
  - `Создать новый стикерсет`
  - `Добавить в существующий`

`/cancel` доступна в любой момент: очищает состояние и завершает диалог.

### Создать новый стикерсет
1. **Название** – бот просит и сохраняет отображаемое название.
2. **Первый стикер** – пользователь отправляет файл (PNG/JPG/WebP), бот конвертирует в WebP.
3. **Эмодзи** – сопоставляем эмодзи со стикером.
4. **Повторение** – сообщение вида «Стикер добавлен… отправь следующий файл или нажми “Готово”».
   - При файле → шаги 2–3.
5. **Готово** – бот просит короткое имя (латиница/цифры/`_`), проверяет доступность,
   создаёт набор (`createNewStickerSet`), докидывает остальные стикеры и сохраняет ссылку.
6. **Финал** – сообщение со ссылкой `https://t.me/addstickers/<name>` и отметкой о сохранении в галерею (если успешно).
7. **Публикация** – бот предлагает опубликовать набор в галерее (`/internal/stickersets/{id}/publish`). Пользователь выбирает «Опубликовать» или «Оставить приватным».

### Добавить в существующий
1. **Выбор набора** – бот подтягивает наборы автора из галереи:
   - inline-кнопки по 10 на страницу, пагинация `⬅️ Назад / ➡️ Вперед`, `⛔️ Отмена`;
   - названия кликабельны, ведущие на `https://t.me/addstickers/<name>` (используем поле `url`, если есть).
2. **Стикер** – после выбора бот подтверждает ссылкой и просит файл.
3. **Эмодзи** – сопоставляем эмодзи со стикером и добавляем через `addStickerToSet`.
4. **Повторение** – сообщение «Стикер добавлен… отправь ещё файл или нажми “Готово”».
   - При файле → шаги 2–3.
5. **Готово** – бот сообщает о завершении и приглашает начать заново `/start`.

#### Дополнительно
- Все блокирующие вызовы Telegram API и галереи выполняются в фоне (`asyncio.to_thread`).
- `context.user_data` хранит состояние по пользователю; очищается на `/start`, `cancel` и при завершении.
- Конвертация изображений происходит внутри `ImageProcessor.convert_to_webp`.
- Линки на наборы кликабельны в HTML-формате, документы и сообщения логируются в `bot.log`.
